<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Hex Encoding Playground</title>
    <link rel="stylesheet" href="/external/bulma/css/bulma.css" />
    <script src="/wasm/external/go1.24.5_wasm_exec.js"></script>
    <script src="/wasm/encoding/hex/pkg/wasm.js"></script>
  </head>
  <body>
    <div class="notification is-warning" id="decode-error" hidden="true">
      <!-- check out sticky header: https://geedew.com/Creating-a-Sticy-Header-with-Bulma-CSS/ -->
      <button
        class="delete"
        onclick="javascript:document.getElementById('decode-error').setAttribute('hidden', 'true')"
      ></button>
      <div class="content is-large">
        <b><p></p></b>
      </div>
    </div>
    <section class="hero has-text-centered">
      <div class="hero-body">
        <h1 class="title is-1">Hex Encoding Playground</h1>
      </div>
    </section>
    <div class="container">
      <script>
        function toggleTab(cls) {
          const target = document.getElementById(cls + "-toggle");
          [].slice.call(target.parentElement.children).forEach((child) => {
            child.classList.remove("is-active");
          });
          target.classList.add("is-active");
          const tabs = ["encode-tab", "decode-tab"];
          tabs
            .filter((tab) => tab !== cls)
            .forEach((tab) =>
              [].slice
                .call(document.getElementsByClassName(tab))
                .forEach((e) => e.setAttribute("hidden", "true"))
            );
          tabs
            .filter((tab) => tab === cls)
            .forEach((tab) =>
              [].slice
                .call(document.getElementsByClassName(tab))
                .forEach((e) => e.removeAttribute("hidden"))
            );
        }
      </script>
      <div
        class="tabs is-centered is-large is-toggle is-toggle-rounded is-fullwidth"
      >
        <ul>
          <li id="encode-tab-toggle" class="is-active">
            <a href="javascript:toggleTab('encode-tab')">Encode</a>
          </li>
          <li id="decode-tab-toggle">
            <a href="javascript:toggleTab('decode-tab')">Decode</a>
          </li>
        </ul>
      </div>
      <div class="encode-tab">
        <h2 class="subtitle is-2">Input</h2>
        <div class="box">
          <div class="content is-large">
            <p
              contenteditable
              oninput="javascript:document.getElementById('encodeOutput').textContent = wasm.encoding.hex.EncodeToString(this.innerText)"
            ></p>
          </div>
        </div>
        <h2 class="subtitle is-2">Output</h2>
        <div class="box">
          <div class="content is-large">
            <p id="encodeOutput"></p>
          </div>
        </div>
      </div>
      <div class="decode-tab" hidden="true">
        <script>
          let decoderMode = "string";
          function decode() {
            let decoder = wasm.encoding.hex.DecodeString;
            if (decoderMode === "bytes") {
              decoder = wasm.encoding.hex.DecodeStringAsBytes;
            }
            const s = document.getElementById("decode-input").textContent;
            if (s.length === 0) {
              return;
            }
            const value = decoder(s);
            const errorElem = document.getElementById("decode-error");
            if (value instanceof Error) {
              errorElem.removeAttribute("hidden");
              errorElem.querySelector("p").textContent = value.message;
            } else {
              errorElem.setAttribute("hidden", "true");
              if (value instanceof Array) {
                document.getElementById("decodeOutput").textContent =
                  value.join(" ");
              } else {
                document.getElementById("decodeOutput").textContent = value;
              }
            }
          }

          function toggleDecodeAs(mode) {
            if (mode === "string") {
              document
                .getElementById("decode-as-string-toggle")
                .classList.add("is-active");
              document
                .getElementById("decode-as-bytes-toggle")
                .classList.remove("is-active");
              decoderMode = mode;
            }
            if (mode === "bytes") {
              document
                .getElementById("decode-as-string-toggle")
                .classList.remove("is-active");
              document
                .getElementById("decode-as-bytes-toggle")
                .classList.add("is-active");
              decoderMode = mode;
            }
            decode();
          }
        </script>
        <h2 class="subtitle is-2">Input</h2>
        <div class="box">
          <div class="content is-large">
            <p
              contenteditable
              id="decode-input"
              oninput="javascript:decode()"
            ></p>
          </div>
        </div>
        <div class="level">
          <h2 class="subtitle is-2">Output</h2>
          <div class="tabs is-centered is-large is-toggle is-toggle-rounded">
            <ul>
              <li id="decode-as-string-toggle" class="is-active">
                <a href="javascript:toggleDecodeAs('string')">As String</a>
              </li>
              <li id="decode-as-bytes-toggle">
                <a href="javascript:toggleDecodeAs('bytes')">As Bytes</a>
              </li>
            </ul>
          </div>
        </div>
        <div class="box">
          <div class="content is-large">
            <p id="decodeOutput"></p>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
